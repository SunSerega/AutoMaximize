


# [%mode:Write,Read%]Data!AutoSize
ptr: CommandQueue<IntPtr>
!Enqueue
cl.Enqueue{%mode%}Buffer(
  cq, o.Native, Bool.NON_BLOCKING,
  UIntPtr.Zero, o.Size,
  !ptr!,
  !evs!
).RaiseIfError;

# [%mode:Write,Read%]Data
ptr: CommandQueue<IntPtr>; buff_offset, len: CommandQueue<integer>
!Enqueue
cl.Enqueue{%mode%}Buffer(
  cq, o.Native, Bool.NON_BLOCKING,
  new UIntPtr(!buff_offset!), new UIntPtr(!len!),
  !ptr!,
  !evs!
).RaiseIfError;

# [%mode:Write,Read%]Data
ptr: pointer
!ShortDef
{%mode%}Data(IntPtr(ptr));

# [%mode:Write,Read%]Data
ptr: pointer; buff_offset, len: CommandQueue<integer>
!ShortDef
{%mode%}Data(IntPtr(ptr), buff_offset, len);



# WriteValue
val: TRecord
!ShortDef
WriteValue(val, 0);

# WriteValue
val: TRecord; buff_offset: CommandQueue<integer>
!Enqueue
cl.EnqueueWriteBuffer(
  cq, o.Native, Bool.NON_BLOCKING,
  new UIntPtr(!buff_offset!), new UIntPtr(Marshal.SizeOf&<TRecord>),
  new IntPtr(!val:ptr!),
  !evs!
).RaiseIfError;

# WriteValue!Q
val: CommandQueue<TRecord>
!ShortDef
WriteValue(val, 0);

# WriteValue!Q
val: CommandQueue<TRecord>; buff_offset: CommandQueue<integer>
!Enqueue
cl.EnqueueWriteBuffer(
  cq, o.Native, Bool.NON_BLOCKING,
  new UIntPtr(!buff_offset!), new UIntPtr(Marshal.SizeOf&<TRecord>),
  new IntPtr(!val:ptr!),
  !evs!
).RaiseIfError;



# [%mode:Write,Read%]Array[%rank:1,2,3%]!AutoSize
a: CommandQueue<array{%rank? : [,] : [,,] %} of TRecord>
!Enqueue
cl.Enqueue{%mode%}Buffer(
  cq, o.Native, Bool.BLOCKING,
  UIntPtr.Zero, new UIntPtr(!a!.Length*Marshal.SizeOf&<TRecord>),
  !a![{%rank? 0 : 0,0 : 0,0,0 %}],
  !evs!
).RaiseIfError;
!NeedThread

# [%mode:Write,Read%]Array[%rank:1,2,3%]
a: CommandQueue<array{%rank? : [,] : [,,] %} of TRecord>; {%rank? a_offset : a_offset1,a_offset2 : a_offset1,a_offset2,a_offset3 %}, len, buff_offset: CommandQueue<integer>
!Enqueue
cl.Enqueue{%mode%}Buffer(
  cq, o.Native, Bool.BLOCKING,
  new UIntPtr(!buff_offset!), new UIntPtr(!len!*Marshal.SizeOf&<TRecord>),
  !a![{%rank? !a_offset! : !a_offset1!,!a_offset2! : !a_offset1!,!a_offset2!,!a_offset3! %}],
  !evs!
).RaiseIfError;
!NeedThread


